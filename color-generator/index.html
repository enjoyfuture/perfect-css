<!DOCTYPE html>
<html lang="zh-cmn-Hans">
  <head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
      .main {
        width: 500px;
        padding: 50px;
      }

      .header {
        padding: 10px;
        color: #fff;
      }

      .btn {
        position: relative;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        display: inline-block;
        min-width: 5rem;
        height: 2rem;
        padding: 0 1.25rem;
        border: 0;
        border-radius: 0.125rem;
        overflow: hidden;
        font-weight: 500;
        line-height: 2rem;
        background-color: #2196f3;
        color: #fff;
        text-align: center;
        text-decoration: none;
        vertical-align: middle;
        cursor: pointer;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        outline: 0;
      }

      ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      li {
        height: 40px;
        display: flex;
        align-items: center;
        padding: 0 10px;
        color: #fff;
      }
    </style>
  </head>
  <body>
    <div class="main">
      基准颜色：
      <div>
        RGB：<input type="text" id="rgb"/>
      </div>
      <div>
        h: <input type="text" id="h" value="87"/>
        s: <input type="text" id="s" value="100">%
        l: <input type="text" id="l" value="22">%
      </div>
      <p>
        <button class="btn" id="generator">生成颜色面板值</button>
      </p>
      <header id="header" style="margin-top: 10px;">
      </header>
      <ul id="colors"></ul>
    </div>
    <script src="index.js"></script>
    <script>
      (function() {
        function rgbToHsl(r, g, b) {
          r /= 255, g /= 255, b /= 255;
          const max = Math.max(r, g, b), min = Math.min(r, g, b);
          let h, s, l = (max + min) / 2;

          if (max == min) {
            h = s = 0; // achromatic
          } else {
            const d = max - min;
            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
            switch (max) {
              case r:
                h = (g - b) / d + (g < b ? 6 : 0);
                break;
              case g:
                h = (b - r) / d + 2;
                break;
              case b:
                h = (r - g) / d + 4;
                break;
            }
            h /= 6;
          }
          return [h, s, l];
        }

        function hueToRgb(v1, v2, vH) {
          if (vH < 0) vH += 1;
          if (vH > 1) vH -= 1;
          if (6.0 * vH < 1) return v1 + (v2 - v1) * 6.0 * vH;
          if (2.0 * vH < 1) return v2;
          if (3.0 * vH < 2) return v1 + (v2 - v1) * ((2.0 / 3.0) - vH) * 6.0;
          return v1;
        }

        function hslToRgb(h, s, l) {
          let r, g, b;
          let var_1, var_2;
          if (s === 0) {
            r = l * 255.0;
            g = l * 255.0;
            b = l * 255.0;
          } else {
            if (l < 0.5) var_2 = l * (1 + s);
            else var_2 = (l + s) - (s * l);

            var_1 = 2.0 * l - var_2;

            r = 255.0 * hueToRgb(var_1, var_2, h + (1.0 / 3.0));
            g = 255.0 * hueToRgb(var_1, var_2, h);
            b = 255.0 * hueToRgb(var_1, var_2, h - (1.0 / 3.0));
          }
          return r + g + b;
        }

        function generator() {
          const h = document.getElementById("h").value;
          const s = document.getElementById("s").value;
          const l = document.getElementById("l").value;
          const ciao = window.materialpalette({ h, s, l });
          const lis = Object.keys(ciao).map(function(item, index) {
            const color = ciao[item];
            return `<li style="background-color: hsl(${color.h}, ${color.s}%, ${color.l}%)">${item}</li>`;
          });
          document.getElementById("colors").innerHTML = lis.join("");
          document.getElementById("header").innerHTML = `<div class="header" style="background-color: hsl(${h}, ${s}%, ${l}%)"><div>hsl(${h}, ${s}%, ${l}%)</div><div style="margin-top: 8px;">500</div></div>`;
        }

        document.getElementById("generator").addEventListener("click", generator, false);
        generator();

        [].forEach.call(document.querySelectorAll('input'), function(el) {
          el.addEventListener('change', function(e) {
            const target = e.target;
            if(target.id === 'rgb') {
              const rgb = target.value;
              const r = parseInt(rgb.substring(1, 3), 16);
              const g = parseInt(rgb.substring(3, 5), 16);
              const b = parseInt(rgb.substring(5, 7), 16);
              const hsl = rgbToHsl(r, g, b);
              document.getElementById('h').value = hsl[0];
              document.getElementById('s').value = hsl[1];
              document.getElementById('l').value = hsl[2];
            } else {
              const h = document.getElementById('h').value;
              const s = document.getElementById('s').value;
              const l = document.getElementById('l').value;
              const rgb = hslToRgb(h, s, l);
              document.getElementById('rgb').value = rgb;
            }
          });
        })
      })();
    </script>
  </body>
</html>
