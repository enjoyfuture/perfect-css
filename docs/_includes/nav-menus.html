{% assign pagePath = page.url | split: '/' %}
{% assign pagePathSize = pagePath | size %}
{% assign pageLastPath = pagePath | last %}
{% assign prefix = 'docs' %}

<ul class="menu">
  {% for group in site.data.menu %}
  {% assign firstPage = group.pages | first %}
  {% assign link = firstPage.file %}

  {% assign active = nil %}
  {% if page.group == group.file %}
  {% assign active = 'active' %}
  {% endif %}
  <li class="menu-item">
    <a {% if group.file %}href="/{{ prefix }}/{{ group.file }}/{{ link }}{% if link %}/{% endif %}" {% endif %}
       class="menu-title menu-header {{ active }}">{{ group.title }}</a>
    <ul class="menu"{% if page.group != group.file %} style="display: none;"{% endif %}>
      {% for doc in group.pages %}
      {% assign active = nil %}

      {% if page.group == group.file and doc.file == pageLastPath %}
      {% assign active = 'active' %}
      {% endif %}
      <li class="menu-item"><a href="{% if doc.file %}/{{ prefix }}/{{ group.file }}/{{ doc.file }}/{% else %}{{ doc.url }}{% endif %}"
             {% if doc.url %}target="_blank"{% endif %}class="menu-title {{ active }}">{{ doc.title }}</a></li>
      {% endfor %}
    </ul>
  </li>
  {% endfor %}
</ul>

<script>
  $(function () {
    $('.menu').on('click', '.menu-header', function (e) {
      e.preventDefault();
      // 隐藏其他打开的菜单
      $('.menu .menu').slideUp('slow');
      var $el = $(e.currentTarget);
      var $nextEl = $el.next();
      if ($nextEl.is(':visible')) {
        $nextEl.slideUp('slow');
      } else {
        $nextEl.slideDown('slow');
      }
    });

  });
</script>
