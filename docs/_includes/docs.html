<script src="{{ site.baseurl }}/assets/js/vendor/clipboard.min.js"></script>
<script src="{{ site.baseurl }}/assets/js/perfect.js"></script>
<script src="{{ site.baseurl }}/assets/js/util.js"></script>
<script src="{{ site.baseurl }}/assets/js/scrollSpy.js"></script>
{% if page.toc %}
<script src="{{ site.baseurl }}/assets/js/plugins/catalogueSpy.js"></script>
<script>
  $(function () {
    var ScrollSpy = perfect.default.ScrollSpy;
    var CatalogueSpy = perfect.default.CatalogueSpy;
    new ScrollSpy(document.body, {
      menu: '.doc-catalogue-panel',
      container: '.doc-content',
      offset: 70,
      anchor: false,
      extend: true,
      plugins: CatalogueSpy,
    });

    // 窗口滑动到某一位置时，修改目录定位位置
    var $cataloguePanel = $('.doc-catalogue-menu-right .doc-catalogue-panel');
    $(window).on('scroll', function (event) {
      if ($cataloguePanel.is(':visible')) {
        var top = window.scrollY;
        var clientHeight = document.documentElement.clientHeight;
        var scrollHeight = document.documentElement.scrollHeight;
        var contentTop = $('.doc-content').offset().top;

        if (top > scrollHeight - clientHeight) {
          $cataloguePanel.css({
            position: 'absolute',
            top: top + 'px'
          });
        } else if (top + 54 > contentTop) {
          $cataloguePanel.css({
            position: 'fixed',
            top: '54px'
          });
        } else {
          $cataloguePanel.css({
            position: 'static',
          });
        }
      }
    });

    $(window).trigger('scroll');
  });
</script>
{% endif %}

<script>
  $(function () {
    // 展开代码
    $('.doc-example-expand [data-code-icon]').click(function () {
      var $el = $(this);
      var $icon = $el.children();
      var $code = $el.parent().next();
      var $tooltip = $el.next().find('.tooltip-inner');
      if ($icon.hasClass('icon-pure-code')) {
        $icon.removeClass('icon-pure-code');
        $icon.addClass('icon-pure-code-expand');
        $tooltip.text('隐藏 Code');
        $code.fadeIn();
      } else {
        $icon.removeClass('icon-pure-code-expand');
        $icon.addClass('icon-pure-code');
        $tooltip.text('显示 Code');
        $code.fadeOut();
      }
    });

    // 为代码添加复制按钮
    $('.highlight:not(.doc-example-highlight)').each(function () {
      var copyCodeIconHtml = '<div class="doc-code-copy"><i class="icon-pure-copy"></i></div>\n' +
        '    <div class="tooltip tooltip-top"><div class="arrow"></div><div class="tooltip-inner">复制代码</div></div>';
      $(this).before(copyCodeIconHtml);
    });

    // 复制到剪贴板
    var clipboard = new Clipboard('.doc-code-copy', {
      target: function (trigger) {
        return trigger.nextElementSibling.nextElementSibling;
      }
    });

    clipboard.on('success', function (e) {
      var $tooltip = $(e.trigger).next().find('.tooltip-inner');
      $tooltip.text('复制成功');
      e.clearSelection();
    });

    $('.doc-code-copy').mouseleave(function () {
      var $tooltip = $(this).next().find('.tooltip-inner');
      $tooltip.text('复制代码');
    });

//    clipboard.on('error', function (e) {
//      var modifierKey = /Mac/i.test(navigator.userAgent) ? '\u2318' : 'Ctrl-';
//      var fallbackMsg = '请使用快捷键 ' + modifierKey + 'C 来复制';
//      var $tooltip = $(e.trigger).next().find('.tooltip-inner');
//      $tooltip.text('复制成功');
//      e.clearSelection();
//    });

  });

</script>

